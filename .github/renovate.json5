{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: ["config:best-practices", ":semanticCommits", ":automergeDigest"],
  automergeType: "pr",
  platformAutomerge: true,
  customManagers: [
    {
      customType: "regex",
      description: "Update _VERSION variables in Dockerfiles",
      fileMatch: ["(^|/|\\.)Dockerfile$", "(^|/)Dockerfile\\.[^/]*$"],
      matchStrings: [
        "# renovate: datasource=(?<datasource>[a-z-]+?)(?: depName=(?<depName>.+?))? packageName=(?<packageName>.+?)(?: versioning=(?<versioning>[a-z-]+?))?\\s(?:ENV|ARG) .+?_VERSION=(?<currentValue>.+?)\\s",
      ],
    },
  ],
  packageRules: [
    {
      description: "Auto-merge all digest updates regardless of package type",
      matchUpdateTypes: ["digest", "pinDigest"],
      automerge: true,
      automergeType: "pr",
    },
    {
      matchUpdateTypes: ["minor", "patch"],
      matchManagers: ["github-actions"],
      automerge: true,
      automergeType: "pr",
    },
    {
      description: "Auto-merge GitHub Actions digest updates",
      matchUpdateTypes: ["digest", "pinDigest"],
      matchManagers: ["github-actions"],
      automerge: true,
      automergeType: "pr",
    },
    {
      addLabels: ["renovate/container", "type/major"],
      additionalBranchPrefix: "{{parentDir}}-",
      commitMessageExtra: " ( {{currentVersion}} → {{newVersion}} )",
      commitMessagePrefix: "feat({{parentDir}})!: ",
      commitMessageTopic: "{{depName}}",
      labels: ["apps/{{parentDir}}"],
      matchDatasources: ["docker", "github-releases"],
      matchFileNames: ["apps/**/Dockerfile"],
      matchUpdateTypes: ["major"],
    },
    {
      addLabels: ["renovate/container", "type/minor"],
      additionalBranchPrefix: "{{parentDir}}-",
      commitMessageExtra: "( {{currentVersion}} → {{newVersion}} )",
      commitMessageTopic: "{{depName}}",
      labels: ["apps/{{parentDir}}"],
      matchDatasources: ["docker", "github-releases"],
      matchFileNames: ["apps/**/Dockerfile"],
      matchUpdateTypes: ["minor"],
      semanticCommitScope: "{{parentDir}}",
      semanticCommitType: "feat",
      automerge: true,
      automergeType: "pr",
    },
    {
      addLabels: ["renovate/container", "type/patch"],
      additionalBranchPrefix: "{{parentDir}}-",
      commitMessageExtra: "( {{currentVersion}} → {{newVersion}} )",
      commitMessageTopic: "{{depName}}",
      labels: ["apps/{{parentDir}}"],
      matchDatasources: ["docker", "github-releases"],
      matchFileNames: ["apps/**/Dockerfile"],
      matchUpdateTypes: ["patch"],
      semanticCommitScope: "{{parentDir}}",
      semanticCommitType: "fix",
      automerge: true,
      automergeType: "pr",
    },
    {
      addLabels: ["renovate/container", "type/digest"],
      additionalBranchPrefix: "{{parentDir}}-",
      commitMessageExtra: "( {{currentVersion}} → {{newVersion}} )",
      commitMessageTopic: "{{depName}}",
      labels: ["apps/{{parentDir}}"],
      matchDatasources: ["docker"],
      matchFileNames: ["apps/**/Dockerfile"],
      matchUpdateTypes: ["digest", "pinDigest"],
      semanticCommitScope: "{{parentDir}}",
      semanticCommitType: "chore",
      automerge: true,
      automergeType: "pr",
    },
    {
      description: "Disable digest pinning for regex managers in Dockerfile",
      matchManagers: ["custom.regex"],
      matchDatasources: ["docker"],
      pinDigests: false,
    },
    {
      description: "Disable digest pinning problematic Dockerfiles",
      matchDatasources: ["docker"],
      matchFileNames: ["apps/caddy/Dockerfile"],
      pinDigests: false,
    },
  ],
}
